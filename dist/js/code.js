"use strict";jQuery(function(u){var e=[],t=document.querySelector(".center");d(e);var o=!1,s=!1,n=!1;console.log(e);var r=/^1\d{10}$/;u("#register-d1").on("focus",function(){l(u(this),"请输入11位手机号码",!0)}).on("blur",function(){1==c(r,u(this),"请输入正确手机号码")?u.ajax({type:"post",dataType:"json",url:"../api/yonghu.php",data:{name:u(this).val()},success:function(e){console.log(e),o=0==e.num?(a("手机号可以注册",t),!0):(a("手机号已存在,请登录",t),!1)}}):o=!1}),u("#canvas").on("click",function(){d(e)}),u("#register-d2").on("focus",function(){l(u(this),"输入验证码")}).on("blur",function(){u(this).val().toLowerCase()==e.join("")?(n=!0,console.log(n),u(this).next().next().css("display","none"),u(this).css({border:"1px solid #CCC"})):(n=!1,console.log(n),u(this).next().next().css({display:"block",backgroundColor:"#ed787f"}).text("请输入正确的验证码"),u(this).css({border:"1px solid #ff6666"}),u(this).next().css({display:"block"}))});var i=/^[A-Z]\w{5,11}$/;function a(e,t){t.innerText=e,t.style.display="block",setTimeout(function(){t.style.display="none"},2e3),t.style.left=(window.innerWidth-t.offsetWidth)/2+"px",t.style.top=(window.innerHeight-t.offsetHeight)/2+"px"}function l(e,t,o){e.next().next().css({display:"block",backgroundColor:"#CCC"}).text(t),e.css({border:"1px solid #ff6666"}),null!=o&&e.next().css({display:"none"})}function c(e,t,o){if(e.test(t.val()))return console.log(t.val()),t.next().next().css("display","none"),t.css({border:"1px solid #CCC"}),!0;t.next().next().css({display:"block",backgroundColor:"#ed787f"}).text(o),t.css({border:"1px solid #ff6666"}),t.next().css({display:"block"})}function d(e){var t=u("#canvas").width(),o=u("#canvas").height(),s=document.getElementById("canvas"),n=s.getContext("2d");s.width=t,s.height=o;for(var r="a,b,c,d,e,f,g,h,i,j,k,m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,W,X,Y,Z,1,2,3,4,5,6,7,8,9,0".split(","),i=r.length,a=0;a<4;a++){var l=Math.floor(Math.random()*i),c=Math.random()-.5,d=r[l];e[a]=d.toLowerCase();var h=10+20*a,f=20+8*Math.random();n.font="bold 23px 微软雅黑",n.translate(h,f),n.rotate(c),n.fillStyle=p(),n.fillText(d,0,0),n.rotate(-c),n.translate(-h,-f)}for(a=0;a<=5;a++)n.strokeStyle=p(),n.beginPath(),n.moveTo(Math.random()*t,Math.random()*o),n.lineTo(Math.random()*t,Math.random()*o),n.stroke();for(a=0;a<=30;a++){n.strokeStyle=p(),n.beginPath();h=Math.random()*t,f=Math.random()*o;n.moveTo(h,f),n.lineTo(h+1,f+1),n.stroke()}}function p(){return"rgb("+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+","+Math.floor(256*Math.random())+")"}u("#register-d4").on("focus",function(){l(u(this),"6到12位的密码，首字母大写",!0)}).on("blur",function(){var e=c(i,u(this),"请输入正确密码");s=1==e,u("#register-d5").val()!=u(this).val()&&(u(this).next().next().css({display:"block",backgroundColor:"#ed787f"}).text("请输入确定密码"),u(this).css({border:"1px solid #ff6666"}),s=!1)}),u("#register-d5").on("focus",function(){l(u(this),"输入确定密码",!0)}).on("blur",function(){""==u(this).val()?(u(this).next().next().css({display:"block",backgroundColor:"#ed787f"}).text("不能为空"),u(this).css({border:"1px solid #ff6666"}),s=!1):u("#register-d4").val()==u(this).val()?(s=!0,u(this).next().next().css("display","none"),u(this).css({border:"1px solid #CCC"}),u("#register-d4").next().next().css({display:"none",backgroundColor:"#ed787f"}),u("#register-d4").css({border:"1px solid #CCC"})):(s=!1,console.log(s),u(this).next().next().css({display:"block",backgroundColor:"#ed787f"}).text("密码不正确"),u(this).css({border:"1px solid #ff6666"}),u(this).next().css({display:"block"}))}),u("#btn").on("click",function(){if(d(e),console.log(u("#check").get(0).checked),1!=u("#check").get(0).checked)a("请同意协议",t);else if(0==o)a("手机号有误，请检查",t),u("#register-d1").get(0).focus();else if(0==s)a("密码有误，请检查",t),u("#register-d4").get(0).focus();else if(0==n)a("验证码有误，请检查",t),u("#register-d2").get(0).focus();else{u("#register-d1").val(),u("#register-d5").val();u.ajax({type:"post",dataType:"json",url:"../api/zhuce.php",data:{user:u("#register-d1").val(),pass:u("#register-d5").val()},success:function(e){console.log(e),1==e.insert?(u.cookie("user",e.user,{expires:1,path:"/"}),u.cookie("pass",e.pass,{expires:1,path:"/"}),u.cookie("name",e.sole,{expires:1,path:"/"}),u.cookie("bluer",!0,{expires:1,path:"/"}),location.href="../index.html"):a("抱歉，系统出错，请刷新页面",t)}})}})});